import{_ as a,c as s,o as n,aa as e}from"./chunks/framework.d_Ke7vMG.js";const m=JSON.parse('{"title":"03 Coupons在Linux环境部署指南","description":"","frontmatter":{"title":"03 Coupons在Linux环境部署指南","author":"Herman","updateTime":"2021-08-14 13:41","desc":"本篇文章主要是记录Coupons项目在Linux环境下的安装过程","categories":"MyProjects","tags":"淘宝客/淘客开源","outline":"deep"},"headers":[],"relativePath":"Notes/No1MyProjects/Coupons/03 Coupons在Linux环境部署指南.md","filePath":"Notes/No1MyProjects/Coupons/03 Coupons在Linux环境部署指南.md","lastUpdated":1723563552000}'),p={name:"Notes/No1MyProjects/Coupons/03 Coupons在Linux环境部署指南.md"},t=e(`<p>本篇文章主要是记录Coupons项目在Linux环境下的安装过程</p><p>Coupons是一个从前端到后端完全开源的淘宝客项目，当初学习完uniapp之后想做一个实战项目，所以才研发了这个项目。由于本人平时主要从事后端研发，界面样式非我所长，所以大家觉得界面效果不好的可以自己修改。目前项目已经支持打包成App、微信小程序、QQ小程序、Web站点；理论上其他小程序支持，可能需要微调</p><p>Github地址： 项目地址：<a href="https://github.com/silently9527/coupons" target="_blank" rel="noreferrer">https://github.com/silently9527/coupons</a></p><h2 id="在线体验地址" tabindex="-1">在线体验地址 <a class="header-anchor" href="#在线体验地址" aria-label="Permalink to &quot;在线体验地址&quot;">​</a></h2><table><tbody><tr><td align="center">App下载地址</td><td align="center">QQ小程序</td><td align="center">微信小程序</td><td align="center">Web站点</td></tr><tr style="background-color:white;"><td align="center"><img width="200" src="https://tva1.sinaimg.cn/large/008eGmZEgy1gn4esj3uutj30b40b4jsx.jpg"></td><td align="center"><img width="200" src="https://tva1.sinaimg.cn/large/008eGmZEgy1gn4et70ft2j30g40g4gm6.jpg"></td><td align="center"><img width="200" src="https://tva1.sinaimg.cn/large/008eGmZEgy1gn4etut7d1j3076076aa2.jpg"></td><td align="center"><img width="200" src="https://tva1.sinaimg.cn/large/008eGmZEgy1gn4euhcqonj30b40b43yt.jpg"></td></tr></tbody></table><p>App下载地址(用手机访问才能正确下载IOS和安卓版本): <a href="http://static.szjx.top/download/index.html" target="_blank" rel="noreferrer">http://static.szjx.top/download/index.html</a></p><p>Web站点(用手机访问，PC端未适配)：<a href="http://m.szjx.top" target="_blank" rel="noreferrer">http://m.szjx.top</a></p><h2 id="效果预览" tabindex="-1">效果预览 <a class="header-anchor" href="#效果预览" aria-label="Permalink to &quot;效果预览&quot;">​</a></h2><table><tbody><tr style="background-color:white;"><td align="center"><img width="200" src="https://tva1.sinaimg.cn/large/008eGmZEly1gn4hfiqyqoj30ku11240m.jpg"></td><td align="center"><img width="200" src="https://tva1.sinaimg.cn/large/008eGmZEly1gn4hggo8thj30ku112aba.jpg"></td><td align="center"><img width="200" src="https://tva1.sinaimg.cn/large/008eGmZEly1gn4hge5bwuj30ku112my9.jpg"></td><td align="center"><img width="200" src="https://tva1.sinaimg.cn/large/008eGmZEly1gn4hgbc1e2j30ku112dhz.jpg"></td></tr><tr style="background-color:white;"><td align="center"><img width="200" src="https://tva1.sinaimg.cn/large/008eGmZEly1gn4hg8p7uhj30ku112acg.jpg"></td><td align="center"><img width="200" src="https://tva1.sinaimg.cn/large/008eGmZEly1gn4hg5kj8lj30ku112tc6.jpg"></td><td align="center"><img width="200" src="https://tva1.sinaimg.cn/large/008eGmZEly1gn4hg10sibj30ku112acs.jpg"></td><td align="center"><img width="200" src="https://tva1.sinaimg.cn/large/008eGmZEly1gn4hft8rzcj30ku1123yt.jpg"></td></tr></tbody></table><hr><h1 id="一、运行环境" tabindex="-1">一、运行环境 <a class="header-anchor" href="#一、运行环境" aria-label="Permalink to &quot;一、运行环境&quot;">​</a></h1><h3 id="java" tabindex="-1">Java <a class="header-anchor" href="#java" aria-label="Permalink to &quot;Java&quot;">​</a></h3><ol><li><p>使用yum来搜索安装包 <code>yum search openjdk</code><img src="https://raw.githubusercontent.com/silently9527/images/main/008i3skNgy1gty1ttcjeej61kq0hitgf02.jpg" alt=""></p></li><li><p>这里我们选择安装Java8的开发环境,执行如下命令</p></li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>yum -y install java-1.8.0-openjdk.x86_64</span></span></code></pre></div><ol start="3"><li>验证是否安装成功</li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>java -version</span></span></code></pre></div><p>输入如下内容表示安装成功</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>openjdk version &quot;1.8.0_302&quot;</span></span>
<span class="line"><span>OpenJDK Runtime Environment (build 1.8.0_302-b08)</span></span>
<span class="line"><span>OpenJDK 64-Bit Server VM (build 25.302-b08, mixed mode)</span></span></code></pre></div><h3 id="maven" tabindex="-1">Maven <a class="header-anchor" href="#maven" aria-label="Permalink to &quot;Maven&quot;">​</a></h3><p>Maven的安装过程参考</p><h3 id="mysql" tabindex="-1">MySQL <a class="header-anchor" href="#mysql" aria-label="Permalink to &quot;MySQL&quot;">​</a></h3><p>[Mysql的详细安装教程参考](docs/src/Notes/TechColumn/03 中间件/01 Mysql的安装教程以及开启远程访问.md)</p><h3 id="redis" tabindex="-1">Redis <a class="header-anchor" href="#redis" aria-label="Permalink to &quot;Redis&quot;">​</a></h3><p>[Redis的详细安装教程参考链接](docs/src/Notes/TechColumn/03 中间件/03 Redis的安装教程.md)</p><h3 id="nginx" tabindex="-1">Nginx <a class="header-anchor" href="#nginx" aria-label="Permalink to &quot;Nginx&quot;">​</a></h3><p>[Nginx的详细安装教程参考](docs/src/Notes/TechColumn/03 中间件/04 Nginx安装的详细教程.md)</p><hr><h1 id="二、注册第三方账号" tabindex="-1">二、注册第三方账号 <a class="header-anchor" href="#二、注册第三方账号" aria-label="Permalink to &quot;二、注册第三方账号&quot;">​</a></h1><h3 id="_1-注册大淘客账号" tabindex="-1">1. 注册大淘客账号 <a class="header-anchor" href="#_1-注册大淘客账号" aria-label="Permalink to &quot;1. 注册大淘客账号&quot;">​</a></h3><p>MallCoupons后端项目中使用的商品数据都是由大淘客API提供 ;</p><p>首先需要注册大淘客账号<a href="https://www.dataoke.com/" target="_blank" rel="noreferrer">https://www.dataoke.com/</a></p><p>进入到大淘客开放平台创建一个应用，为应用一键添加所有的API接口 <img src="https://raw.githubusercontent.com/silently9527/images/main/008i3skNgy1gtz7w4jxowj60u00fkmxm02.jpg" alt=""></p><h3 id="_2-开通mobtech免费短信服务-非必须-需要打包app应用才是需要使用" tabindex="-1">2. 开通MobTech免费短信服务(非必须，需要打包app应用才是需要使用) <a class="header-anchor" href="#_2-开通mobtech免费短信服务-非必须-需要打包app应用才是需要使用" aria-label="Permalink to &quot;2. 开通MobTech免费短信服务(非必须，需要打包app应用才是需要使用)&quot;">​</a></h3><p>MallCoupons在App中是通过手机号和验证码的方式登录，MobTech提供了免费的短信验证码服务。</p><p>注册MobTech账号 <a href="https://www.mob.com/" target="_blank" rel="noreferrer">https://www.mob.com/</a></p><p>进入到开发者平台，创建应用 <img src="https://raw.githubusercontent.com/silently9527/images/main/008i3skNgy1gtz7we5u64j60u00893yh02.jpg" alt=""></p><h3 id="_3-注册qq小程序-非必须-根据个人需要" tabindex="-1">3. 注册QQ小程序(非必须，根据个人需要) <a class="header-anchor" href="#_3-注册qq小程序-非必须-根据个人需要" aria-label="Permalink to &quot;3. 注册QQ小程序(非必须，根据个人需要)&quot;">​</a></h3><h3 id="_4-注册微信小程序-非必须-根据个人需要" tabindex="-1">4. 注册微信小程序(非必须，根据个人需要) <a class="header-anchor" href="#_4-注册微信小程序-非必须-根据个人需要" aria-label="Permalink to &quot;4. 注册微信小程序(非必须，根据个人需要)&quot;">​</a></h3><hr><h1 id="三、下载源码并解压" tabindex="-1">三、下载源码并解压 <a class="header-anchor" href="#三、下载源码并解压" aria-label="Permalink to &quot;三、下载源码并解压&quot;">​</a></h1><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>wget https://codeload.github.com/silently9527/coupons/zip/refs/heads/master</span></span>
<span class="line"><span>unzip coupons-master.zip</span></span></code></pre></div><hr><h1 id="四、创建数据库并初始化" tabindex="-1">四、创建数据库并初始化 <a class="header-anchor" href="#四、创建数据库并初始化" aria-label="Permalink to &quot;四、创建数据库并初始化&quot;">​</a></h1><ol><li>输入密码登陆MySQL数据库</li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>mysql --port=3309 -uroot -p</span></span></code></pre></div><ol start="2"><li>创建数据库mall-coupons</li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>create database mall-coupons default character set utf8mb4 collate utf8mb4_unicode_ci;</span></span></code></pre></div><ol start="3"><li>执行如下命令初始化数据库</li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>use mall-coupons;</span></span>
<span class="line"><span>source /Users/xxx/Downloads/coupons-master/doc/scheme.sql</span></span></code></pre></div><blockquote><p>source命令后面的文件路径替换成你自己的路径；</p></blockquote><hr><h1 id="五、后端项目打包" tabindex="-1">五、后端项目打包 <a class="header-anchor" href="#五、后端项目打包" aria-label="Permalink to &quot;五、后端项目打包&quot;">​</a></h1><ol><li>进入到解压项目的coupons-master/server/src/main/resources目录下</li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>cd coupons-master/server/src/main/resources</span></span></code></pre></div><ol start="2"><li>vim编辑文件<code>application-prod.properties</code>，修改文件中的必要参数</li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>#填写前面淘客注册应用的 AppKey、AppSecret</span></span>
<span class="line"><span>dataoke.appKey=</span></span>
<span class="line"><span>dataoke.appSecret=</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#填写前面注册QQ小程序的appId、appSecret</span></span>
<span class="line"><span>spring.social.qq.app-id=</span></span>
<span class="line"><span>spring.social.qq.app-secret=</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#填写前面注册微信小程序的appId、appSecret</span></span>
<span class="line"><span>spring.social.wechat.app-id=</span></span>
<span class="line"><span>spring.social.wechat.app-secret=</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 配置MySQL数据库的地址</span></span>
<span class="line"><span>spring.datasource.url=jdbc:mysql://localhost:3306/mall-coupons?autoReconnect=true&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;allowMultiQueries=true&amp;serverTimezone=Asia/Shanghai</span></span>
<span class="line"><span>spring.datasource.username=root</span></span>
<span class="line"><span>spring.datasource.password=xxx</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 配置Redis服务器地址</span></span>
<span class="line"><span>spring.redis.host=</span></span>
<span class="line"><span>spring.redis.password=</span></span>
<span class="line"><span>spring.redis.port=</span></span>
<span class="line"><span></span></span>
<span class="line"><span># mob短信服务的appkey，需要打包收集app的才需要</span></span>
<span class="line"><span>mob.service.appkey=</span></span></code></pre></div><ol start="3"><li>打包Java项目</li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>mvn clean package -DskipTests</span></span></code></pre></div><p>当出现了Build Success的时候就表示打包完成</p><p><img src="https://raw.githubusercontent.com/silently9527/images/main/008i3skNgy1gtz6iv61w1j61fu0lan4702.jpg" alt=""></p><p>打包完成之后当前目录会生成<code>target</code>目录，<code>cd target</code>进入到目录，查看是否有生成文件<code>mall-coupons-server-0.0.1-SNAPSHOT.jar</code></p><p><img src="https://raw.githubusercontent.com/silently9527/images/main/008i3skNgy1gtz6i0q7n3j619e08umzr02.jpg" alt=""></p><ol start="4"><li>启动运行<code>mall-coupons-server-0.0.1-SNAPSHOT.jar</code></li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>java -Djava.security.egd=file:/dev/./urandom -jar mall-coupons-server-0.0.1-SNAPSHOT.jar --spring.profiles.active=prod &gt; ./mall-coupons-server.log  &amp;</span></span></code></pre></div><hr><h1 id="六、nginx配置" tabindex="-1">六、Nginx配置 <a class="header-anchor" href="#六、nginx配置" aria-label="Permalink to &quot;六、Nginx配置&quot;">​</a></h1><ol><li>进入到目录<code>/etc/nginx/conf.d</code>,创建配置文件<code>coupon.conf</code></li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>cd /etc/nginx/conf.d</span></span>
<span class="line"><span>touch coupon.conf</span></span></code></pre></div><ol start="2"><li>编辑配置文件<code>coupon.conf</code>，输入如下内容：</li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>upstream coupons-services {</span></span>
<span class="line"><span>    server localhost:9090 weight=10;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>server {</span></span>
<span class="line"><span>    listen       80;</span></span>
<span class="line"><span>    server_name  你的域名;</span></span>
<span class="line"><span>    include /etc/nginx/default.d/*.conf;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    location / {</span></span>
<span class="line"><span>	    add_header Access-Control-Allow-Origin *;</span></span>
<span class="line"><span>    	add_header Access-Control-Allow-Methods &#39;GET, POST, OPTIONS&#39;;</span></span>
<span class="line"><span>    	add_header Access-Control-Allow-Headers &#39;DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization,x-auth-token&#39;; </span></span>
<span class="line"><span>    	if ($request_method = &#39;OPTIONS&#39;) {</span></span>
<span class="line"><span>            return 204;</span></span>
<span class="line"><span>    	}</span></span>
<span class="line"><span>        proxy_pass http://coupons-services/;</span></span>
<span class="line"><span>        proxy_set_header Host $host;</span></span>
<span class="line"><span>        proxy_set_header X-Real-IP $remote_addr;</span></span>
<span class="line"><span>        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span></span>
<span class="line"><span>        client_max_body_size    10000m;</span></span>
<span class="line"><span>        proxy_set_header X-Forwarded-Proto $scheme;</span></span>
<span class="line"><span>        proxy_set_header X-Forwarded-Port $server_port;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    error_page 404 /404.html;</span></span>
<span class="line"><span>        location = /40x.html {</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    error_page 500 502 503 504 /50x.html;</span></span>
<span class="line"><span>        location = /50x.html {</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre></div><ol start="3"><li>重启nginx</li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>systemctl restart nginx</span></span></code></pre></div><hr><h1 id="七、前端项目打包" tabindex="-1">七、前端项目打包 <a class="header-anchor" href="#七、前端项目打包" aria-label="Permalink to &quot;七、前端项目打包&quot;">​</a></h1><ol><li><p>前端项目的源码目录<code>coupons-master/client</code> 导入前端代码到HBuilder中，如何使用HBuilder导入项目、打包可以参考官方文档 <a href="https://uniapp.dcloud.io/quickstart-hx" target="_blank" rel="noreferrer">https://uniapp.dcloud.io/quickstart-hx</a></p></li><li><p>修改发送短信的模版id（只有需要打包app才需要），文件的路径<code>pages/public/login.vue</code>中92行配置短信模板的id，这里的模版id需要在短信平台mob上面申请</p></li></ol><p><img src="https://raw.githubusercontent.com/silently9527/images/main/008i3skNgy1gtz7l1dcw0j60pc0gbaao02.jpg" alt=""></p><ol start="3"><li><p>在uniapp的插件中心购买集成mob的插件；MobTech短信原生插件 <a href="https://ext.dcloud.net.cn/plugin?id=2189" target="_blank" rel="noreferrer">https://ext.dcloud.net.cn/plugin?id=2189</a></p></li><li><p>之后在HBuilder中配置appkey <img src="https://raw.githubusercontent.com/silently9527/images/main/008i3skNgy1gtz7mq0h7tj60u00ktq3s02.jpg" alt=""></p></li><li><p>配置后台api的请求地址，编辑<code>client/config.js</code>输入自己服务器的域名地址</p></li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>module.exports = {</span></span>
<span class="line"><span>    // APIHOST: &quot;http://localhost:9090&quot;</span></span>
<span class="line"><span>}</span></span></code></pre></div>`,78),i=[t];function l(o,c,r,d,h,g){return n(),s("div",null,i)}const b=a(p,[["render",l]]);export{m as __pageData,b as default};
