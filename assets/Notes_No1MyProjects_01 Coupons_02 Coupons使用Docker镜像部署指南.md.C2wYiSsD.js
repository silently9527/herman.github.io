import{_ as s,c as n,o as e,aa as a}from"./chunks/framework.DtK4gh9F.js";const m=JSON.parse('{"title":"02 使用Docker镜像部署指南","description":"","frontmatter":{"title":"02 使用Docker镜像部署指南","author":"Herman","updateTime":"2021-08-14 13:41","desc":"本篇文章主要是记录Coupons项目使用Docker的安装过程","categories":"MyProjects","tags":"淘宝客/淘客开源","outline":"deep"},"headers":[],"relativePath":"Notes/No1MyProjects/01 Coupons/02 Coupons使用Docker镜像部署指南.md","filePath":"Notes/No1MyProjects/01 Coupons/02 Coupons使用Docker镜像部署指南.md","lastUpdated":1724593073000}'),t={name:"Notes/No1MyProjects/01 Coupons/02 Coupons使用Docker镜像部署指南.md"},p=a(`<p>Coupons是一个从前端到后端完全开源的淘宝客项目，当初学习完uniapp之后想做一个实战项目，所以才研发了这个项目。由于本人平时主要从事后端研发，界面样式非我所长，所以大家觉得界面效果不好的可以自己修改。目前项目已经支持打包成App、微信小程序、QQ小程序、Web站点；理论上其他小程序支持，可能需要微调</p><p>Github地址： 项目地址：<a href="https://github.com/silently9527/coupons" target="_blank" rel="noreferrer">https://github.com/silently9527/coupons</a></p><h2 id="在线体验地址" tabindex="-1">在线体验地址 <a class="header-anchor" href="#在线体验地址" aria-label="Permalink to &quot;在线体验地址&quot;">​</a></h2><table><tbody><tr><td align="center">App下载地址</td><td align="center">QQ小程序</td><td align="center">微信小程序</td><td align="center">Web站点</td></tr><tr style="background-color:white;"><td align="center"><img width="200" src="https://cdn.jsdelivr.net/gh/silently9527/images/008eGmZEgy1gn4esj3uutj30b40b4jsx.jpg"></td><td align="center"><img width="200" src="https://cdn.jsdelivr.net/gh/silently9527/images/008eGmZEgy1gn4et70ft2j30g40g4gm6.jpg"></td><td align="center"><img width="200" src="https://cdn.jsdelivr.net/gh/silently9527/images/008eGmZEgy1gn4etut7d1j3076076aa2.jpg"></td><td align="center"><img width="200" src="https://cdn.jsdelivr.net/gh/silently9527/images/008eGmZEgy1gn4euhcqonj30b40b43yt.jpg"></td></tr></tbody></table><p>App下载地址(用手机访问才能正确下载IOS和安卓版本): <a href="http://static.szjx.top/download/index.html" target="_blank" rel="noreferrer">http://static.szjx.top/download/index.html</a></p><p>Web站点(用手机访问，PC端未适配)：<a href="http://m.szjx.top" target="_blank" rel="noreferrer">http://m.szjx.top</a></p><h2 id="效果预览" tabindex="-1">效果预览 <a class="header-anchor" href="#效果预览" aria-label="Permalink to &quot;效果预览&quot;">​</a></h2><table><tbody><tr style="background-color:white;"><td align="center"><img width="200" src="https://cdn.jsdelivr.net/gh/silently9527/images/008eGmZEly1gn4hfiqyqoj30ku11240m.jpg"></td><td align="center"><img width="200" src="https://cdn.jsdelivr.net/gh/silently9527/images/008eGmZEly1gn4hggo8thj30ku112aba.jpg"></td><td align="center"><img width="200" src="https://cdn.jsdelivr.net/gh/silently9527/images/008eGmZEly1gn4hge5bwuj30ku112my9.jpg"></td><td align="center"><img width="200" src="https://cdn.jsdelivr.net/gh/silently9527/images/008eGmZEly1gn4hgbc1e2j30ku112dhz.jpg"></td></tr><tr style="background-color:white;"><td align="center"><img width="200" src="https://cdn.jsdelivr.net/gh/silently9527/images/008eGmZEly1gn4hg8p7uhj30ku112acg.jpg"></td><td align="center"><img width="200" src="https://cdn.jsdelivr.net/gh/silently9527/images/008eGmZEly1gn4hg5kj8lj30ku112tc6.jpg"></td><td align="center"><img width="200" src="https://cdn.jsdelivr.net/gh/silently9527/images/008eGmZEly1gn4hg10sibj30ku112acs.jpg"></td><td align="center"><img width="200" src="https://cdn.jsdelivr.net/gh/silently9527/images/008eGmZEly1gn4hft8rzcj30ku1123yt.jpg"></td></tr></tbody></table><hr><h1 id="一、开始启动服务器" tabindex="-1">一、开始启动服务器 <a class="header-anchor" href="#一、开始启动服务器" aria-label="Permalink to &quot;一、开始启动服务器&quot;">​</a></h1><p>在 Docker Hub 上发布的镜像为 <code>silently9527/coupons-server</code></p><ol><li>创建工作目录</li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>mkdir -p ~/.coupons/conf &amp;&amp; cd ~/.coupons/conf</span></span></code></pre></div><ol start="2"><li>下载示例配置文件到工作目录</li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>wget https://raw.githubusercontent.com/silently9527/coupons/master/doc/application.properties</span></span></code></pre></div><ol start="3"><li>编辑配置文件，配置数据库或者端口等</li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>vim application.properties</span></span></code></pre></div><blockquote><p>如何注册第三方账号以及初始化数据库请参考 <a href="https://silently9527.cn/?p=67" target="_blank" rel="noreferrer">https://silently9527.cn/?p=67</a></p></blockquote><ol start="4"><li>创建容器并运行</li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>docker run -it -d --name coupons-server -p 9090:9090 -v ~/.coupons:/root/.coupons --restart=unless-stopped silently9527/coupons-server:v1.0.0</span></span></code></pre></div><p>参数说明：</p><ul><li>-it： 开启输入功能并连接伪终端</li><li>-d： 后台运行容器</li><li>–name： 为容器指定一个名称</li><li>-p： 端口映射，格式为 主机(宿主)端口:容器端口 ，可在 application.yaml 配置。</li><li>-v： 工作目录映射。形式为：-v 宿主机路径:/root/.coupons，后者不能修改。</li><li>–restart： 建议设置为 unless-stopped，在 Docker 启动的时候自动启动 coupons-server 容器。</li></ul><ol start="5"><li>使用如下命令查看日志是否启动成功</li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>docker ps</span></span>
<span class="line"><span>docker log -f xxx</span></span></code></pre></div><p><img src="https://cdn.jsdelivr.net/gh/silently9527/images/008i3skNgy1gu2or68as9j61vs07840102.jpg" alt=""></p><p>当看在日志中如下内容表示启动成功</p><p><img src="https://cdn.jsdelivr.net/gh/silently9527/images/008i3skNgy1gu2ov30ps9j62ke0b0wmi02.jpg" alt=""></p><h1 id="二、-nginx安装" tabindex="-1">二、 Nginx安装 <a class="header-anchor" href="#二、-nginx安装" aria-label="Permalink to &quot;二、 Nginx安装&quot;">​</a></h1><h3 id="nginx的详细安装教程参考-https-silently9527-cn-p-66" tabindex="-1">Nginx的详细安装教程参考 <a href="https://silently9527.cn/?p=66" target="_blank" rel="noreferrer">https://silently9527.cn/?p=66</a> <a class="header-anchor" href="#nginx的详细安装教程参考-https-silently9527-cn-p-66" aria-label="Permalink to &quot;Nginx的详细安装教程参考 [https://silently9527.cn/?p=66](https://silently9527.cn/?p=66)&quot;">​</a></h3><h3 id="nginx配置" tabindex="-1">Nginx配置 <a class="header-anchor" href="#nginx配置" aria-label="Permalink to &quot;Nginx配置&quot;">​</a></h3><ol><li>进入到目录<code>/etc/nginx/conf.d</code>,创建配置文件<code>coupon.conf</code></li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>cd /etc/nginx/conf.d</span></span>
<span class="line"><span>touch coupon.conf</span></span></code></pre></div><ol start="2"><li>编辑配置文件<code>coupon.conf</code>，输入如下内容：</li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>upstream coupons-services {</span></span>
<span class="line"><span>    server localhost:9090 weight=10;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>server {</span></span>
<span class="line"><span>    listen       80;</span></span>
<span class="line"><span>    server_name  你的域名;</span></span>
<span class="line"><span>    include /etc/nginx/default.d/*.conf;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    location / {</span></span>
<span class="line"><span>	    add_header Access-Control-Allow-Origin *;</span></span>
<span class="line"><span>    	add_header Access-Control-Allow-Methods &#39;GET, POST, OPTIONS&#39;;</span></span>
<span class="line"><span>    	add_header Access-Control-Allow-Headers &#39;DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization,x-auth-token&#39;; </span></span>
<span class="line"><span>    	if ($request_method = &#39;OPTIONS&#39;) {</span></span>
<span class="line"><span>            return 204;</span></span>
<span class="line"><span>    	}</span></span>
<span class="line"><span>        proxy_pass http://coupons-services/;</span></span>
<span class="line"><span>        proxy_set_header Host $host;</span></span>
<span class="line"><span>        proxy_set_header X-Real-IP $remote_addr;</span></span>
<span class="line"><span>        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span></span>
<span class="line"><span>        client_max_body_size    10000m;</span></span>
<span class="line"><span>        proxy_set_header X-Forwarded-Proto $scheme;</span></span>
<span class="line"><span>        proxy_set_header X-Forwarded-Port $server_port;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    error_page 404 /404.html;</span></span>
<span class="line"><span>        location = /40x.html {</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    error_page 500 502 503 504 /50x.html;</span></span>
<span class="line"><span>        location = /50x.html {</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre></div><ol start="3"><li>重启nginx</li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>systemctl restart nginx</span></span></code></pre></div><hr><h1 id="三、前端项目打包" tabindex="-1">三、前端项目打包 <a class="header-anchor" href="#三、前端项目打包" aria-label="Permalink to &quot;三、前端项目打包&quot;">​</a></h1><ol><li><p>前端项目的源码目录<code>coupons-master/client</code> 导入前端代码到HBuilder中，如何使用HBuilder导入项目、打包可以参考官方文档 <a href="https://uniapp.dcloud.io/quickstart-hx" target="_blank" rel="noreferrer">https://uniapp.dcloud.io/quickstart-hx</a></p></li><li><p>修改发送短信的模版id（只有需要打包app才需要），文件的路径<code>pages/public/login.vue</code>中92行配置短信模板的id，这里的模版id需要在短信平台mob上面申请</p></li></ol><p><img src="https://cdn.jsdelivr.net/gh/silently9527/images/008i3skNgy1gtz7l1dcw0j60pc0gbaao02.jpg" alt=""></p><ol start="3"><li><p>在uniapp的插件中心购买集成mob的插件；MobTech短信原生插件 <a href="https://ext.dcloud.net.cn/plugin?id=2189" target="_blank" rel="noreferrer">https://ext.dcloud.net.cn/plugin?id=2189</a></p></li><li><p>之后在HBuilder中配置appkey <img src="https://cdn.jsdelivr.net/gh/silently9527/images/008i3skNgy1gtz7mq0h7tj60u00ktq3s02.jpg" alt=""></p></li><li><p>配置后台api的请求地址，编辑<code>client/config.js</code>输入自己服务器的域名地址</p></li></ol><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>module.exports = {</span></span>
<span class="line"><span>    // APIHOST: &quot;http://localhost:9090&quot;</span></span>
<span class="line"><span>}</span></span></code></pre></div>`,42),l=[p];function i(o,c,r,d,h,g){return e(),n("div",null,l)}const b=s(t,[["render",i]]);export{m as __pageData,b as default};
