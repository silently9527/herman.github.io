<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Herman's Notes | Herman</title>
    <meta name="description" content="Herman's Notes: 个人技术知识库，记录 & 分享个人碎片化、结构化、体系化的技术知识内容。">
    <meta name="generator" content="VitePress v1.3.2">
    <link rel="preload stylesheet" href="/assets/style.sdTm41_T.css" as="style">
    
    <script type="module" src="/assets/app.CORe1L_m.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.CY6JQSYe.js">
    <link rel="modulepreload" href="/assets/chunks/framework.D1poPhlk.js">
    <link rel="modulepreload" href="/assets/Notes_Learning_Vue 源码 - 响应式系统.md.iU9tx_6x.lean.js">
    <link rel="icon" href="/favicon.ico">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-a9a9e638><!--[--><!--]--><!--[--><span tabindex="-1" data-v-c3508ec8></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-c3508ec8> Skip to content </a><!--]--><!----><header class="VPNav" data-v-a9a9e638 data-v-f1e365da><div class="VPNavBar has-sidebar top" data-v-f1e365da data-v-822684d1><div class="wrapper" data-v-822684d1><div class="container" data-v-822684d1><div class="title" data-v-822684d1><div class="VPNavBarTitle has-sidebar" data-v-822684d1 data-v-28a961f9><a class="title" href="/" data-v-28a961f9><!--[--><!--]--><!--[--><img class="VPImage logo" src="/favicon.ico" alt data-v-35a7d0b8><!--]--><span data-v-28a961f9>Herman&#39;s Notes</span><!--[--><!--]--></a></div></div><div class="content" data-v-822684d1><div class="content-body" data-v-822684d1><!--[--><!--]--><div class="VPNavBarSearch search" data-v-822684d1><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-822684d1 data-v-e6d46098><span id="main-nav-aria-label" class="visually-hidden" data-v-e6d46098> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/AboutMe.html" tabindex="0" data-v-e6d46098 data-v-ed5ac1f6><!--[--><span data-v-ed5ac1f6>👋 About</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/Notes/index.html" tabindex="0" data-v-e6d46098 data-v-ed5ac1f6><!--[--><span data-v-ed5ac1f6>💭 Notes</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/Projects.html" tabindex="0" data-v-e6d46098 data-v-ed5ac1f6><!--[--><span data-v-ed5ac1f6>🦄 Projects</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/Friends.html" tabindex="0" data-v-e6d46098 data-v-ed5ac1f6><!--[--><span data-v-ed5ac1f6>👫 Friends</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-822684d1 data-v-af096f4a><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-af096f4a data-v-e40a8bb6 data-v-4a1c76db><span class="check" data-v-4a1c76db><span class="icon" data-v-4a1c76db><!--[--><span class="vpi-sun sun" data-v-e40a8bb6></span><span class="vpi-moon moon" data-v-e40a8bb6></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-822684d1 data-v-164c457f data-v-ee7a9424><!--[--><a class="VPSocialLink no-icon" href="https://github.com/silently9527" aria-label="github" target="_blank" rel="noopener" data-v-ee7a9424 data-v-717b8b75><span class="vpi-social-github" /></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-822684d1 data-v-925effce data-v-e5380155><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-e5380155><span class="vpi-more-horizontal icon" data-v-e5380155></span></button><div class="menu" data-v-e5380155><div class="VPMenu" data-v-e5380155 data-v-7dd3104a><!----><!--[--><!--[--><!----><div class="group" data-v-925effce><div class="item appearance" data-v-925effce><p class="label" data-v-925effce>Appearance</p><div class="appearance-action" data-v-925effce><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-925effce data-v-e40a8bb6 data-v-4a1c76db><span class="check" data-v-4a1c76db><span class="icon" data-v-4a1c76db><!--[--><span class="vpi-sun sun" data-v-e40a8bb6></span><span class="vpi-moon moon" data-v-e40a8bb6></span><!--]--></span></span></button></div></div></div><div class="group" data-v-925effce><div class="item social-links" data-v-925effce><div class="VPSocialLinks social-links-list" data-v-925effce data-v-ee7a9424><!--[--><a class="VPSocialLink no-icon" href="https://github.com/silently9527" aria-label="github" target="_blank" rel="noopener" data-v-ee7a9424 data-v-717b8b75><span class="vpi-social-github" /></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-822684d1 data-v-5dea55bf><span class="container" data-v-5dea55bf><span class="top" data-v-5dea55bf></span><span class="middle" data-v-5dea55bf></span><span class="bottom" data-v-5dea55bf></span></span></button></div></div></div></div><div class="divider" data-v-822684d1><div class="divider-line" data-v-822684d1></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-a9a9e638 data-v-070ab83d><div class="container" data-v-070ab83d><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-070ab83d><span class="vpi-align-left menu-icon" data-v-070ab83d></span><span class="menu-text" data-v-070ab83d>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-070ab83d data-v-bc9dc845><button data-v-bc9dc845>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-a9a9e638 data-v-18756405><div class="curtain" data-v-18756405></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-18756405><span class="visually-hidden" id="sidebar-aria-label" data-v-18756405> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-9e426adc><section class="VPSidebarItem level-0 collapsible is-link" data-v-9e426adc data-v-196b2e5f><div class="item" tabindex="0" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/Notes/Interviews/index.html" data-v-196b2e5f><!--[--><h2 class="text" data-v-196b2e5f>🏃 八股面经</h2><!--]--></a><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-196b2e5f><span class="vpi-chevron-right caret-icon" data-v-196b2e5f></span></div></div><div class="items" data-v-196b2e5f><!--[--><div class="VPSidebarItem level-1 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/Notes/Interviews/%E9%9D%A2%E7%BB%8F%E6%80%BB%E7%BB%93.html" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>面经总结</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/Notes/Interviews/JavaScript%20%E7%9B%B8%E5%85%B3.html" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>JavaScript 相关</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/Notes/Interviews/%E6%89%8B%E5%86%99%E4%B8%8E%E5%9C%BA%E6%99%AF%E6%A8%A1%E6%8B%9F%E9%A2%98.html" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>手写与场景模拟题</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/Notes/Interviews/Vue%20%E7%9B%B8%E5%85%B3.html" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>Vue 相关</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/Notes/Interviews/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8E%9F%E7%90%86%E4%B8%8E%E8%AE%A1%E7%BD%91.html" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>浏览器原理与计网</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/Notes/Interviews/HTML%E4%B8%8ECSS.html" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>HTML与CSS</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/Notes/Interviews/%E5%AE%9E%E4%B9%A0%E6%8A%95%E9%80%92%E8%AE%B0%E5%BD%95.html" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>实习投递记录</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/Notes/Interviews/%E7%A7%8B%E6%8B%9B%E6%8A%95%E9%80%92%E8%AE%B0%E5%BD%95.html" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>秋招投递记录</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-9e426adc><section class="VPSidebarItem level-0 collapsible is-link has-active" data-v-9e426adc data-v-196b2e5f><div class="item" tabindex="0" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/Notes/Learning/index.html" data-v-196b2e5f><!--[--><h2 class="text" data-v-196b2e5f>🎨 学习笔记</h2><!--]--></a><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-196b2e5f><span class="vpi-chevron-right caret-icon" data-v-196b2e5f></span></div></div><div class="items" data-v-196b2e5f><!--[--><div class="VPSidebarItem level-1 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/Notes/Learning/HTML%20%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>HTML 学习笔记</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/Notes/Learning/ES6%20%E6%96%B0%E7%89%B9%E6%80%A7.html" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>ES6 新特性</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/Notes/Learning/triggerEvent%20%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95.html" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>triggerEvent 踩坑记录</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/Notes/Learning/CSS%20%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.html" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>CSS 基础知识</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/Notes/Learning/TailwindCSS%20%E4%BD%BF%E7%94%A8%E6%89%8B%E5%86%8C.html" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>TailwindCSS 使用手册</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/Notes/Learning/Rollup%20%E9%A3%9F%E7%94%A8%E6%8C%87%E5%8D%97.html" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>Rollup 食用指南</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/Notes/Learning/TypeScript%20%E9%80%9F%E6%95%88%E6%95%91%E5%BF%83%E4%B8%B8.html" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>TypeScript 速效救心丸</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/Notes/Learning/Vue%20%E6%BA%90%E7%A0%81%20-%20%E5%93%8D%E5%BA%94%E5%BC%8F%E7%B3%BB%E7%BB%9F.html" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>Vue 源码 - 响应式系统</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/Notes/Learning/Vue%20%E6%BA%90%E7%A0%81%20-%20%E6%B8%B2%E6%9F%93%E5%99%A8.html" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>Vue 源码 - 渲染器</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/Notes/Learning/Git%20%E5%85%A5%E9%97%A8%E6%9C%80%E9%80%9F%E4%BC%A0%E8%AF%B4.html" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>Git 入门最速传说</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-9e426adc><section class="VPSidebarItem level-0 collapsible is-link" data-v-9e426adc data-v-196b2e5f><div class="item" tabindex="0" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/Notes/Thoughts/index.html" data-v-196b2e5f><!--[--><h2 class="text" data-v-196b2e5f>🔮 随想杂文</h2><!--]--></a><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-196b2e5f><span class="vpi-chevron-right caret-icon" data-v-196b2e5f></span></div></div><div class="items" data-v-196b2e5f><!--[--><div class="VPSidebarItem level-1 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/Notes/Thoughts/%E7%AC%AC%E5%85%AD%E5%B1%8A%E5%AD%97%E8%8A%82%E9%9D%92%E8%AE%AD%E7%BB%93%E8%90%A5%E6%80%BB%E7%BB%93.html" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>第六届字节青训结营总结</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/Notes/Thoughts/%E4%BB%96%E5%B1%B1%E4%B9%8B%E7%9F%B3.html" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>他山之石</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/Notes/Thoughts/%E6%B4%BB%E5%8A%A8%E6%97%A5%E5%BF%97.html" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>活动日志</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-196b2e5f data-v-196b2e5f><div class="item" data-v-196b2e5f><div class="indicator" data-v-196b2e5f></div><a class="VPLink link link" href="/Notes/Thoughts/%E5%A6%99%E5%A6%99%E5%B7%A5%E5%85%B7.html" data-v-196b2e5f><!--[--><p class="text" data-v-196b2e5f>妙妙工具</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-a9a9e638 data-v-91765379><div class="VPDoc has-sidebar has-aside" data-v-91765379 data-v-83890dd9><!--[--><!--]--><div class="container" data-v-83890dd9><div class="aside" data-v-83890dd9><div class="aside-curtain" data-v-83890dd9></div><div class="aside-container" data-v-83890dd9><div class="aside-content" data-v-83890dd9><div class="VPDocAside" data-v-83890dd9 data-v-6d7b3c46><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-6d7b3c46 data-v-b38bf2ff><div class="content" data-v-b38bf2ff><div class="outline-marker" data-v-b38bf2ff></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-b38bf2ff>导航栏</div><ul class="VPDocOutlineItem root" data-v-b38bf2ff data-v-3f927ebe><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-6d7b3c46></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-83890dd9><div class="content-container" data-v-83890dd9><!--[--><!--]--><main class="main" data-v-83890dd9><div style="position:relative;" class="vp-doc _Notes_Learning_Vue%20%E6%BA%90%E7%A0%81%20-%20%E5%93%8D%E5%BA%94%E5%BC%8F%E7%B3%BB%E7%BB%9F" data-v-83890dd9><div><p>这是笔者在阅读《Vue.js 设计与实现》第二篇“响应系统”过程中的心得体会 💗。</p><h2 id="响应系统概述" tabindex="-1">响应系统概述 <a class="header-anchor" href="#响应系统概述" aria-label="Permalink to &quot;响应系统概述&quot;">​</a></h2><p>首先我们需要明确一个概念：什么是<strong>响应式数据</strong>？</p><p>回忆曾经编写过的 Vue 项目代码，我们或许可以给出这样一个定义：<strong>当一个变量发生变化时，所有与之相关的地方也会随之变化</strong>。我们来看这样一个例子：</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> obj</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { text: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Hello world!&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> };</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> effect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  document.body.innerHTML </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> obj.text;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>在这段代码中，<code>effect</code> 函数会设置 <code>body</code> 的文本内容。但是，除了 <code>effect</code> 函数，其他任何函数也可以读取或设置 <code>body</code> 的文本内容。也就是说，<code>effect</code> 函数的执行可能会影响其他函数的执行，产生副作用。在这种情况下，我们称 <code>effect</code> 为一个<strong>副作用函数</strong>。</p><p>此时我们可以对响应式数据进行略微专业一点的定义：<strong>当一个变量发生变化时，所有与该变量有关的副作用会自动重新执行</strong>。对于上述代码，当我们运行 <code>obj.text = &#39;Hello javascript&#39;</code> 时，我希望副作用函数 <code>effect</code> 会重新执行。</p><hr><p>那么为了实现响应式系统，我们需要解决以下几个问题：</p><ol><li>🔗 哪些副作用函数与响应式数据有关？</li><li>🚄 当响应式数据变化时，如何重新执行所有相关的副作用函数？</li></ol><p>Vue 给出的解决方案是：通过 Proxy 拦截一个对象的<strong>读取</strong>与<strong>设置</strong>操作:</p><ul><li>当副作用函数试图读取对象的某个属性时，我们会将该副作用函数存储在一个【容器】中。</li><li>当对象的某个属性被设置时，我们又会从【容器】中取出相关的副作用函数并重新执行它们。</li></ul><p>然而，仅仅通过 Proxy 对数据进行劫持还是不够的，虽然 Proxy 可以告诉我们一个数据被访问或修改了，但它不能告诉我们这个操作是在哪个副作用函数中发生的，我们需要一个额外的工具来告诉 Proxy 这个数据到底被哪个副作用函数所依赖。这个工具我们姑且称之为 <code>effect</code>，它的作用是注册一个副作用函数。</p><p>✨ 分析至此，一个基本的响应系统，应该包含以下三个模块：</p><ol><li><code>track</code>: 当对象的读取操作触发时，进行副作用函数依赖收集。</li><li><code>trigger</code>: 当对象的设置操作触发时，重新执行所有相关的副作用函数。</li><li><code>effect</code>: 用于注册副作用函数，在 Proxy 拦截读取操作时，标记当前活跃的副作用函数。</li></ol><h2 id="实现基本的响应式" tabindex="-1">实现基本的响应式 <a class="header-anchor" href="#实现基本的响应式" aria-label="Permalink to &quot;实现基本的响应式&quot;">​</a></h2><h3 id="副作用函数的容器结构" tabindex="-1">副作用函数的容器结构 <a class="header-anchor" href="#副作用函数的容器结构" aria-label="Permalink to &quot;副作用函数的容器结构&quot;">​</a></h3><p>在上文的叙述中，我们可以注意到无论是拦截读取还是设置操作，都需要用到一个存放副作用函数的“容器”。那么这个容器具体的数据结构是怎样的呢？回顾上文提到的代码：</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> effect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  document.body.innerHTML </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> obj.text;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>在这段代码中存在三个角色 👨：</p><ul><li>被操作（读取）的代理对象 obj</li><li>被操作（读取）的字段名 text</li><li>副作用函数 effect</li></ul><p>根据上述信息，我们可以设计出这样的容器结构 🍧 ：<code>WeakMap&lt;object,Map&lt;key,Set&lt;effectFn&gt;&gt;&gt;</code></p><p>它的含义是：</p><ul><li><code>WeakMap</code> 的键是被代理的对象，值是一个 <code>Map</code>。使用 <code>WeakMap</code> 是为了防止内存泄漏，当对象不再被引用时，可以自动释放内存。</li><li><code>Map</code> 的键是对象的字段名，值是一个 <code>Set</code>。</li><li><code>Set</code> 中存储的是与特定对象的特定字段相关联的所有副作用函数。</li></ul><p>这样设计的目的是为了在对象的某个字段发生变化时，能够迅速找到所有相关的副作用函数并重新执行它们。具体的查找过程是：首先在 <code>WeakMap</code> 中根据对象找到对应的<code>Map</code>，然后在 <code>Map</code> 中根据字段名找到对应的 <code>Set</code> ，最后在 <code>Set</code> 中找到所有的副作用函数。</p><h3 id="注册副作用函数" tabindex="-1">注册副作用函数 <a class="header-anchor" href="#注册副作用函数" aria-label="Permalink to &quot;注册副作用函数&quot;">​</a></h3><p>上文提到，我们需要一个额外的工具 <code>effect</code> 来跟踪哪个副作用函数正在访问哪个响应式数据，这个过程我们称之为“注册副作用函数”📝。事实上这个工具的实现非常简单，首先我们 <code>effect</code> 函数传入一个副作用函数，利用全局变量 <code>activeEffect</code> 将其标记为 “当前活跃的副作用函数”。然后，我们会执行传入的副作用函数，在这个副作用函数的执行过程中，每当访问到一个响应式数据，就会被 Proxy 所拦截，这时我们就可以将 <code>activeEffect</code> 加入到上文提到的容器之中。这样，我们就建立了副作用函数和响应式数据之间的联系 😃。</p><p>一个简单的 <code>effect</code> 实现如下：（真正的 <code>effect</code> 函数需要考虑更多的情况）</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> activeEffect </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> effect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">fn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  activeEffect </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> effectFn;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  fn</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="依赖收集与触发更新" tabindex="-1">依赖收集与触发更新 <a class="header-anchor" href="#依赖收集与触发更新" aria-label="Permalink to &quot;依赖收集与触发更新&quot;">​</a></h3><p>在 Vue 的响应系统中，依赖收集与触发更新是两个核心的步骤 🔥，虽然上文中已经提到过了，但不妨再过一遍整个流程。</p><p>首先我们通过 Proxy 拦截对象 <code>obj</code> 的读取与设置操作。</p><p>随后我们注册一个副作用函数，该副作用函数读取了 <code>obj.text</code>，在这个过程中，Proxy 对象会拦截这个<strong>读取</strong>操作，并且调用 <code>track</code> 函数。<code>track</code> 函数的作用是将当前活跃的副作用函数（由全局的 <code>activeEffect</code> 变量表示）添加到该属性的依赖列表中（借助前文提到的容器）。这样，我们就实现了对于 <code>obj.text</code> 的依赖收集.</p><p>然后我们尝试修改 <code>obj.text</code> 的值 ⚙️， 在这个过程中，Proxy 对象会拦截这个<strong>设置</strong>操作，并且调用 <code>trigger</code> 函数。trigger 函数的作用是根据该对象与属性，在副作用函数的容器中找到所有依赖于该属性的副作用函数，并重新执行这些函数。这样，我们就实现了 <code>obj.text</code> 变化引发的更新。</p><p>一个简单的代理函数实现如下：</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> reactive</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">obj</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">){</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Proxy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(obj,{</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">target</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">){</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      track</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(target,key); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 读取时收集依赖</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> target[key];</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">target</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">newVal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">){</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      trigger</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(target,key); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 设置时触发更新</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      target[key] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> newVal;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 此时 person 就是一个响应式数据</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> person</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> reactive</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({name: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;John&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, age:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">18</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><h2 id="拓展处理" tabindex="-1">拓展处理 <a class="header-anchor" href="#拓展处理" aria-label="Permalink to &quot;拓展处理&quot;">​</a></h2><h3 id="effect-存在的问题" tabindex="-1">effect 存在的问题 <a class="header-anchor" href="#effect-存在的问题" aria-label="Permalink to &quot;effect 存在的问题&quot;">​</a></h3><p>在注册副作用函数时，我们还需要考虑两个问题 🚧。</p><ol><li>【嵌套副作用】</li></ol><p>在一个副作用函数中又注册另一个副作用函数，就会导致 <code>activeEffect</code> 被覆盖，所以可以应当将 <code>activeEffect</code> 设置为<strong>栈结构</strong>。</p><ol start="2"><li>【分支切换】</li></ol><p>在副作用函数中，可能存在这样的代码: <code>return flag?obj.foo:obj.bar</code> ，当 <code>flag</code> 不同时，应该与不同的响应式数据建立联系，同时也应当删除已建立的联系。解决方法其实很简单，在每次执行副作用函数之前，先把之间建立的所有依赖字段都删除了，然后在执行函数的过程中，又会对响应式数据进行读取，这就建立了新的依赖关系。</p><p>然后在之前进行依赖收集的时候，我们收集的是对象字段 =&gt; 副作用的联系，我们并不知道当前副作用函数依赖于哪些字段，所以在 <code>track</code> 时我们需要反向收集一下依赖以便调用前清除。</p><h3 id="响应系统的可调度性-🎨" tabindex="-1">响应系统的可调度性 🎨 <a class="header-anchor" href="#响应系统的可调度性-🎨" aria-label="Permalink to &quot;响应系统的可调度性 🎨&quot;">​</a></h3><p>所谓可调度，就是当 <code>trigger</code> 动作触发副作用函数执行时，我们有能力决定副作用函数执行的时机、次数以及方式。</p><p>在现有的 <code>effect</code> 函数中，我们会在注册副作用函数时立即执行一次。然而，有时我们可能不希望副作用函数立即执行，而是希望能够在适当的时机手动调用。此时我们可以引入 <code>lazy</code> 选项，在 <code>effect</code> 函数中将注册后的副作用函数返回，以便人为地决定其调用时机。</p><p>上面提到的其实是副作用第一次触发的时机，我们还希望实现 <code>trigger</code> 时能够自定义副作用的执行过程。我们可以引入 <code>scheduler</code> 选项来指定调度器。在 <code>trigger</code> 触发时，我们会执行调度器，并将当前的副作用函数作为参数传递给调度器。在调度器中，我们可以自定义代码来控制副作用函数的执行过程。</p><h3 id="计算属性-computed" tabindex="-1">计算属性 computed <a class="header-anchor" href="#计算属性-computed" aria-label="Permalink to &quot;计算属性 computed&quot;">​</a></h3><p>计算属性(<code>computed</code>)的核心是一个<strong>延迟执行的副作用函数</strong>。通过引入懒加载标记，我们可以手动调用这个副作用函数来获取其返回值。</p><p>在使用 <code>computed</code> 时，我们传入一个 <code>getter</code> 函数作为参数。这个函数会被用来创建一个带有懒加载功能的 <code>effectFn</code>。<code>computed</code> 函数会返回一个对象，其中的 <code>value</code> 是一个访问器属性。每当我们尝试读取 <code>value</code> 的值时，就会手动执行 <code>effectFn</code> 并返回其结果。</p><p>需要注意的是，如果在一个副作用函数中访问了计算属性的值，那么当计算属性的值发生变化时，这个副作用函数也应该重新执行。但是，由于 <code>computed</code> 返回的并不是一个<strong>响应式对象</strong>，访问计算属性的值并不会进行依赖收集，也就<strong>无法触发更新</strong>🚨。</p><p>为了解决这个问题，我们可以在读取 <code>value</code> 时，手动触发依赖追踪(<code>track</code>)，建立 <code>computedObj.value</code> 与副作用函数之间的关系。然后，当 <code>computedObj.value</code> 更新时，手动触发触发器(<code>trigger</code>)，通知所有依赖于该计算属性的副作用函数重新执行。</p><p>然而，这样的设计还缺少<strong>数据缓存</strong>📚 的功能。为了解决这个问题，我们可以引入一个 <code>dirty</code> 标记和一个 <code>lastVal</code>。当我们尝试获取计算属性的值时，首先会检查 <code>dirty</code> 标记，如果数据已经被修改（即为脏数据），则会重新计算并返回计算属性的值。否则，我们将直接返回上一次计算的结果，即 <code>lastVal</code>。我们可以在 <code>effect</code> 的第二个选项参数调度器(<code>scheduler</code>) 中重置 <code>dirty</code> 标记。当响应式数据发生变化时，调度器将被执行，数据将被标记为 <code>dirty</code> ，这样在下一次读取时，数据将会被重新计算。</p><h3 id="监听器-watch" tabindex="-1">监听器 watch <a class="header-anchor" href="#监听器-watch" aria-label="Permalink to &quot;监听器 watch&quot;">​</a></h3><p>监听器(<code>watch</code>)其主要功能是<strong>观测 👀 一个响应式数据，当数据发生变化时通知并执行相应的回调函数 🏃，在回调函数中我们能够获取到数据变换前后的值</strong>。<code>watch</code> 的实现基于 <code>effect</code> 以及其 <code>scheduler</code> 选项参数。</p><p>首先，我们需要实现<strong>对响应式数据的监视</strong>🧐。用户传入的可能是对象，也可能是一个 <code>getter</code> 函数。如果传入的是对象，我们需要深度遍历该对象的所有属性，并追踪所有属性的副作用。通常，我们会编写一个 <code>traverse</code> 函数来递归实现这个过程。</p><p>其次，我们需要实现数据变化时<strong>触发回调函数</strong>🚄 的功能。实际上，我们可以将 <code>effect</code> 的 <code>scheduler</code> 选项视为回调函数。对于用户传入的响应式数据，我们将其封装为一个带有 <code>lazy</code> 标记的副作用函数，并将用户传入的回调函数放在 <code>scheduler</code> 中。这样，一旦数据发生变化，调度器就会被执行，进而触发我们的回调函数。</p><p>最后，我们需要解决<strong>获取旧值和新值</strong>🦄 的问题。我们可以在初始化 <code>watch</code> 时手动调用副作用函数以获取一个值，该值可以视为旧值。然后，在调度器触发时，我们再次调用该副作用函数以获取新值。</p><p>关于监听器，还有更多的扩展内容，例如 <code>immediate / flush / onInvalidate</code> 等，但这些内容在此不作详细讨论。🐷</p><h3 id="对象-数组响应式" tabindex="-1">对象 &amp; 数组响应式 <a class="header-anchor" href="#对象-数组响应式" aria-label="Permalink to &quot;对象 &amp; 数组响应式&quot;">​</a></h3><p>首先，我们需要明确一个概念，Vue 的响应式是通过 Proxy 拦截对象的<strong>读取</strong>与<strong>设置</strong>操作。这里的读取与设置操作，其实是一个很宽泛的概念。下面我们来具体看一下普通对象的读取和设置操作。</p><p>读取操作包括 🔥：</p><ol><li>访问属性：例如 <code>obj.text</code>，这会触发 <code>get</code> 操作的拦截。</li><li>判断对象或原型上是否存在给定的 <code>key</code>：例如 <code>key in obj</code>，这会触发 <code>has</code> 操作的拦截。</li><li>使用 <code>for...in</code> 循环遍历对象：例如 <code>for(const key in obj){}</code>，这会触发 <code>ownKeys</code> 操作的拦截。</li></ol><p>设置操作包括 💧：</p><ol><li>通过 <code>obj.foo</code> 可以设置或者添加属性，这会触发 <code>set</code> 操作的拦截，我们需要区分是增加属性还是设置属性。</li><li>通过 <code>delete obj.bar</code> 可以删除属性，这会触发 <code>deleteProperty</code> 操作的拦截。</li></ol><p>需要注意的是，在拦截 <code>ownKeys</code> 操作时，我们会新建一个 <code>symbol</code> 变量来标记与其相关的副作用依赖。当增加或删除属性时，应该触发与 <code>for...in</code> 相关的副作用。</p><hr><p>对于数组而言，情况会有所不同：</p><ol><li>⚔️ 索引与 <code>length</code></li></ol><ul><li>通过索引可以修改或增加元素，当索引值大于数组长度时，就是增加元素 假设当前对象为数组且为增加元素的操作，那么应该触发与 <code>length</code> 相关的副作用</li><li>通过 <code>length</code> 也会影响数组元素，当 <code>length</code> 设置为小于原来长度时 相当于将 <code>index &gt; newLength</code> 的数据设置为 <code>undefined</code>，需要触发相关的副作用</li></ul><ol start="2"><li>🔮 <code>for...in</code> 与 <code>for...of</code> 遍历</li></ol><ul><li>对于 <code>for...in</code> 我们使用 <code>proxy</code> 的 <code>ownKeys</code> 去拦截，普通对象我们是采用一个 <code>symbol</code> 去收集相关副作用，对于数组来说，<code>for...in</code> 与长度或者说元素的个数息息相关，所以我们可以直接使用 <code>length</code> 属性去收集相关副作用。</li><li>对于 <code>for...of</code> ，其本质上是去访问数组的内置属性 <code>Symbol(Symbol.iterator)</code>. 事实上我们什么也不用做，就能实现目的。然而因为我们读取了 <code>Symbol</code> 类型的属性，追踪它们的副作用可能会产生意料之外的错误，所以我们需要在拦截读取的时候避免追踪 <code>Symbol</code> 类型的副作用。</li></ul><ol start="3"><li>🎁 数组的查找方法:</li></ol><p>当在数组中进行查找时，用户可能使用原始对象也可能使用代理对象，我们需要重写相关的方法（如 <code>includes,indexOf,lastIndexOf</code>）以进行额外处理。当我们在数组中找不到代理对象时，就去数组中寻找原始对象。</p><ol start="4"><li>💰 隐式改变数组长度的方法：<code>push,pop,shift</code> 等</li></ol><p>当调用数组的 <code>push</code> 方法时，既会读取 <code>length</code> 属性又会设置 <code>length</code> 属性，这会导致两个独立的副作用函数互相影响，进而导致栈溢出。解决方案是引入 <code>shouldTrack</code>，在调用方法前令 <code>shouldTrack</code> 为假，同时在 <code>track</code> 时检查 <code>shouldTrack</code>，如果为假则不追踪。这就实现了调用方法时屏蔽对 <code>length</code> 的追踪。当然，为了保证其响应式能力，我们还需要在执行副作用函数之前，将 <code>shouldTrack</code> 恢复成原来的状态。</p><h3 id="原始值响应式方案-ref" tabindex="-1">原始值响应式方案 ref <a class="header-anchor" href="#原始值响应式方案-ref" aria-label="Permalink to &quot;原始值响应式方案 ref&quot;">​</a></h3><p><code>ref</code>在 Vue 中的主要目的是解决两个关键问题：代理原始值的问题和响应式丢失的问题。</p><ol><li><p><strong>代理原始值的问题</strong></p><p>在 JavaScript 中，<code>Proxy</code>无法直接代理原始值。为了解决这个问题，Vue 引入了<code>ref</code>。<code>ref</code>的实质是创建一个新的对象，将原始值包裹在这个对象中，然后将这个包裹对象传递给<code>reactive</code>。这样，原始值就可以间接地实现响应式。然而，这样做的结果是<code>ref</code>和普通对象在本质上没有什么区别，因此需要一个标志来区分<code>ref</code>和普通对象。</p></li><li><p><strong>响应式丢失的问题</strong></p><p>响应式丢失是指当我们通过展开运算符从响应式对象创建一个普通对象时，如果响应式对象发生修改，创建的普通对象并不能收到这个修改，也不能触发相关的副作用。<code>toRef</code>和<code>toRefs</code>函数就是为了解决这个问题而设计的。<code>toRef</code>可以对响应式对象的某个属性进行包裹，返回一个包装后的对象。这个对象有一个访问器属性<code>value</code>，当读取<code>value</code>的值时，实际上是读取的响应式对象的值；当设置<code>value</code>的值时，实际上是在设置响应式对象的值。这样，我们就可以自由地使用展开运算符，而不会丢失响应能力。</p></li></ol><p>然而，使用<code>ref</code>时，我们需要通过<code>.value</code>的形式去访问原始值，这对开发者来说是一种心智负担。为了解决这个问题，Vue 引入了<code>proxyRefs</code>函数。<code>proxyRefs</code>函数对传入的参数进行了代理，拦截读取和设置操作。如果传入的对象是<code>ref</code>类型，读取和设置操作就直接对<code>.value</code>进行。这样，开发者就可以无需访问<code>value</code>属性，就能读取<code>ref</code>的值。</p></div></div></main><footer class="VPDocFooter" data-v-83890dd9 data-v-4f9813fa><!--[--><!--]--><div class="edit-info" data-v-4f9813fa><!----><div class="last-updated" data-v-4f9813fa><div class="py-1 text-sm font-medium" data-v-4f9813fa> 📝 Last updated: 2023-10-13 23:07</div></div></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-4f9813fa><span class="visually-hidden" id="doc-footer-aria-label" data-v-4f9813fa>Pager</span><div class="pager" data-v-4f9813fa><a class="VPLink link pager-link prev" href="/Notes/Learning/TypeScript%20%E9%80%9F%E6%95%88%E6%95%91%E5%BF%83%E4%B8%B8.html" data-v-4f9813fa><!--[--><span class="desc" data-v-4f9813fa>Previous page</span><span class="title" data-v-4f9813fa>TypeScript 速效救心丸</span><!--]--></a></div><div class="pager" data-v-4f9813fa><a class="VPLink link pager-link next" href="/Notes/Learning/Vue%20%E6%BA%90%E7%A0%81%20-%20%E6%B8%B2%E6%9F%93%E5%99%A8.html" data-v-4f9813fa><!--[--><span class="desc" data-v-4f9813fa>Next page</span><span class="title" data-v-4f9813fa>Vue 源码 - 渲染器</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="relative px-6 pt-8 pb-4 text-center border-t dark:border-zinc-800 sm:pt-8 text-black/40 dark:text-zinc-300/40" data-v-a9a9e638><p class="text-sm font-medium">Copyright © 2023-present Herman</p><p class="text-sm font-medium"> Theme | <a href="https://github.com/ZbWeR/easy-vitepress-blog">easy-vitepress-blog</a></p></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"aboutme.md\":\"DmtvVsV_\",\"friends.md\":\"ClW-Det9\",\"index.md\":\"Bo6IcEEY\",\"notes_index.md\":\"Ayig0Z-C\",\"notes_interviews_html与css.md\":\"DgE4Q30Q\",\"notes_interviews_index.md\":\"CMaQDoSw\",\"notes_interviews_javascript 相关.md\":\"BG7TQQ_a\",\"notes_interviews_vue 相关.md\":\"BtQ0odaY\",\"notes_interviews_实习投递记录.md\":\"BLY-L9vc\",\"notes_interviews_手写与场景模拟题.md\":\"C_UZt-hr\",\"notes_interviews_浏览器原理与计网.md\":\"C5s4mxQS\",\"notes_interviews_秋招投递记录.md\":\"F7SQpygt\",\"notes_interviews_面经总结.md\":\"oWQx5Qpg\",\"notes_learning_css 基础知识.md\":\"Df4lyGQI\",\"notes_learning_es6 新特性.md\":\"CKlO4BBC\",\"notes_learning_git 入门最速传说.md\":\"ZHIWtpDw\",\"notes_learning_html 学习笔记.md\":\"DcbaMZgI\",\"notes_learning_index.md\":\"CdRsMNJm\",\"notes_learning_rollup 食用指南.md\":\"BaD5qfG1\",\"notes_learning_tailwindcss 使用手册.md\":\"Yp1ZgvqF\",\"notes_learning_triggerevent 踩坑记录.md\":\"DiFFd68v\",\"notes_learning_typescript 速效救心丸.md\":\"G0zXN7GZ\",\"notes_learning_vue 源码 - 响应式系统.md\":\"iU9tx_6x\",\"notes_learning_vue 源码 - 渲染器.md\":\"EKTnNw4M\",\"notes_thoughts_index.md\":\"CRNoXnAK\",\"notes_thoughts_他山之石.md\":\"7awkVeN5\",\"notes_thoughts_妙妙工具.md\":\"DZPltDrd\",\"notes_thoughts_活动日志.md\":\"B3rDkCf5\",\"notes_thoughts_第六届字节青训结营总结.md\":\"S0HAnluU\",\"projects.md\":\"DnQ-HIKj\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Herman's Notes\",\"titleTemplate\":\"Herman\",\"description\":\"Herman's Notes: 个人技术知识库，记录 & 分享个人碎片化、结构化、体系化的技术知识内容。\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"logo\":\"/favicon.ico\",\"nav\":[{\"text\":\"👋 About\",\"link\":\"AboutMe.md\"},{\"text\":\"💭 Notes\",\"link\":\"/Notes/index\"},{\"text\":\"🦄 Projects\",\"link\":\"Projects.md\"},{\"text\":\"👫 Friends\",\"link\":\"Friends.md\"}],\"sidebar\":{\"/Notes/\":{\"text\":\"Notes\",\"items\":[{\"text\":\"🏃 八股面经\",\"items\":[{\"updateTime\":\"2023-09-17 15:12\",\"desc\":\"常考八股文收录,适合中国宝宝体质的八股速通\",\"tags\":\"八股\",\"outline\":2,\"link\":\"/Notes/Interviews/面经总结\",\"text\":\"面经总结\"},{\"updateTime\":\"2023-11-27 10:55\",\"desc\":\"教练，我想成为前端高手！JavaScript 是世界上最好的语言！(雾\",\"tags\":\"八股/JavaScript\",\"outline\":\"deep\",\"link\":\"/Notes/Interviews/JavaScript 相关\",\"text\":\"JavaScript 相关\"},{\"updateTime\":\"2024-03-07 23:44\",\"desc\":\"前端面试高频手写题与场景题, 目前收录并发请求控制...\",\"tags\":\"八股\",\"outline\":2,\"link\":\"/Notes/Interviews/手写与场景模拟题\",\"text\":\"手写与场景模拟题\"},{\"updateTime\":\"2024-03-10 11:24\",\"desc\":\"Vue 八股文の个人理解，包括响应式原理、Pinia 原理与简单实现、router 简要原理\",\"tags\":\"八股/Vue\",\"outline\":\"deep\",\"link\":\"/Notes/Interviews/Vue 相关\",\"text\":\"Vue 相关\"},{\"updateTime\":\"2024-03-13 01:38\",\"desc\":\"面试官：浏览器从输入URL到页面展示的过程是怎样的？浏览器的缓存机制是怎样的？什么是同源策略又有哪些跨域解决方案？你还是支支吾吾一头雾水吗？看完这篇文章，下次面试直接开始吟唱！😎\",\"tags\":\"八股/计算机基础\",\"outline\":2,\"link\":\"/Notes/Interviews/浏览器原理与计网\",\"text\":\"浏览器原理与计网\"},{\"updateTime\":\"2024-07-16 21:34\",\"desc\":\"现代 CSS 的博大精深！好想成为 CSS 高手😭，切最酷的图！本文试图全面记录 CSS 在面试中的考点，探索那些微小但重要的细节。\",\"tags\":\"八股/CSS\",\"outline\":\"deep\",\"link\":\"/Notes/Interviews/HTML与CSS\",\"text\":\"HTML与CSS\"},{\"updateTime\":\"2024-07-24 23:48\",\"desc\":\"2023/24年寒假/暑期实习投递记录，跌跌撞撞一路打怪升级！🏃‍♂️\",\"tags\":\"面经/实习\",\"link\":\"/Notes/Interviews/实习投递记录\",\"text\":\"实习投递记录\"},{\"updateTime\":\"2024-07-24 23:49\",\"desc\":\"2025 应届秋招/提前批投递记录, 我这一生如履薄冰, 我能走到对岸吗？\",\"tags\":\"面经/秋招\",\"link\":\"/Notes/Interviews/秋招投递记录\",\"text\":\"秋招投递记录\"}],\"collapsed\":false,\"link\":\"/Notes/Interviews/index\"},{\"text\":\"🎨 学习笔记\",\"items\":[{\"updateTime\":\"2022-09-19 23:00\",\"desc\":\"HTML萌新入门最佳实践，来自 B 站 Pink 老师的启蒙教育\",\"tags\":\"HTML\",\"outline\":\"deep\",\"link\":\"/Notes/Learning/HTML 学习笔记\",\"text\":\"HTML 学习笔记\"},{\"updateTime\":\"2023-09-16 22:00\",\"desc\":\"ES6新特性记录，来源于蓝桥杯备赛课程\",\"tags\":\"ES6\",\"outline\":\"deep\",\"link\":\"/Notes/Learning/ES6 新特性\",\"text\":\"ES6 新特性\"},{\"updateTime\":\"2023-09-19 20:15\",\"desc\":\" Echarts 中同时设置 triggerEvent 与 tooltip 可能会出现奇怪的显示问题，文中给出了一个简单的解决方案并记录了 radar 雷达图组件多级数据的一个应用场景.\",\"tags\":\"Echarts\",\"outline\":\"deep\",\"link\":\"/Notes/Learning/triggerEvent 踩坑记录\",\"text\":\"triggerEvent 踩坑记录\"},{\"updateTime\":\"2023-09-20 09:41\",\"desc\":\"CSS基础知识记录，包含选择器，字体属性，文本属性，背景属性，显示模式以及常见的布局技巧：标准流，浮动，盒模型\",\"tags\":\"CSS/基础\",\"outline\":\"deep\",\"link\":\"/Notes/Learning/CSS 基础知识\",\"text\":\"CSS 基础知识\"},{\"outline\":\"deep\",\"updateTime\":\"2023-09-27 11:24\",\"tags\":\"tailwind/手册\",\"desc\":\"一文掌握目前最火的原子化 css 解决方案。你将了解到如何在项目中引入 TailwindCSS，以及较为常用的基础语法。\",\"link\":\"/Notes/Learning/TailwindCSS 使用手册\",\"text\":\"TailwindCSS 使用手册\"},{\"outline\":\"deep\",\"updateTime\":\"2023-10-02 16:28\",\"tags\":\"Rollup/手册\",\"desc\":\"快速上手 JavaScript模块打包工具 Rollup。本文将带你了解 Rollup的基本概念以及如何优雅地食用 Rollup.\",\"link\":\"/Notes/Learning/Rollup 食用指南\",\"text\":\"Rollup 食用指南\"},{\"updateTime\":\"2023-10-04 16:09\",\"desc\":\"从零开始的 TypeScript 生活。本文记录了基本的 TypeScript 语法，帮助你快速轻松上手TypeScript （赶鸭子上架！） \",\"tags\":\"TypeScript/手册\",\"outline\":\"deep\",\"link\":\"/Notes/Learning/TypeScript 速效救心丸\",\"text\":\"TypeScript 速效救心丸\"},{\"outline\":\"deep\",\"updateTime\":\"2023-10-13 23:07\",\"tags\":\"Vue/响应式\",\"desc\":\"《Vue.js设计与实现》第二篇“响应系统”的阅读记录\",\"link\":\"/Notes/Learning/Vue 源码 - 响应式系统\",\"text\":\"Vue 源码 - 响应式系统\"},{\"outline\":\"deep\",\"updateTime\":\"2023-10-20 22:05\",\"tags\":\"Vue/渲染器\",\"desc\":\"《Vue.js设计与实现》第三篇“渲染器”的读书笔记，介绍了 Vue 的渲染流程以及 diff 算法的实现\",\"link\":\"/Notes/Learning/Vue 源码 - 渲染器\",\"text\":\"Vue 源码 - 渲染器\"},{\"outline\":2,\"updateTime\":\"2024-04-19 00:11\",\"tags\":\"Git/手册\",\"desc\":\"掌握 Git，成为代码管理的高手！从安装到 SSH 密钥的生成，再到与 GitHub 的亲密接触，本指南带你一步步成为版本控制的大师。不仅如此，还有 VSCode 插件推荐和操作秘籍，让你的开发流程如丝般顺滑。\",\"link\":\"/Notes/Learning/Git 入门最速传说\",\"text\":\"Git 入门最速传说\"}],\"collapsed\":false,\"link\":\"/Notes/Learning/index\"},{\"text\":\"🔮 随想杂文\",\"items\":[{\"updateTime\":\"2023-08-30 23:02\",\"desc\":\"【字节前端青训】个人总结 & 前端一周年\",\"tags\":\"青训\",\"outline\":\"deep\",\"link\":\"/Notes/Thoughts/第六届字节青训结营总结\",\"text\":\"第六届字节青训结营总结\"},{\"updateTime\":\"2023-09-28 09:28\",\"desc\":\"互联网的大海中总有一些宝藏文章...有时候当你想写某个知识点的博客却发现已经有前辈写得相当完备...本系列将收录这些好文，并配上一点小小的读书笔记\",\"tags\":\"Orz\",\"link\":\"/Notes/Thoughts/他山之石\",\"text\":\"他山之石\"},{\"updateTime\":\"2024-05-21 22:15\",\"desc\":\"给那些踌躇满志与混吃等死的日子一个交代...\",\"tags\":\"流水账\",\"link\":\"/Notes/Thoughts/活动日志\",\"text\":\"活动日志\"},{\"updateTime\":\"2024-06-05 20:23\",\"desc\":\"这是一会儿要用到的妙妙工具！\",\"tags\":\"喵喵\",\"link\":\"/Notes/Thoughts/妙妙工具\",\"text\":\"妙妙工具\"}],\"collapsed\":false,\"link\":\"/Notes/Thoughts/index\"}]}},\"search\":{\"provider\":\"local\"},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/silently9527\"}],\"footer\":{\"copyright\":\"Copyright © 2023-present Herman\"},\"outlineTitle\":\"导航栏\"},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>